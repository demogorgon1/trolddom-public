dialogue_screen .swirl_tonkins_greetings:
{
	text: 
	[	
		"Oh, hello. Didn't expect anyone to show up here."
	]				
	
	options:
	[
		{ quest<offer_only>: realm_of_fire_swirl_tonkins_1 }
		{ quest<completion_only>: thalvaron_ghorm_1 }
		{ quest: .swirl_tonkins_2 }
		{ quest<offer_only>: .swirl_tonkins_3 }
		{ quest<completion_only>: .enslaved_fire_elemental }
		{ quest: .swirl_tonkins_4 }
		{ quest: .swirl_tonkins_5 }
		{ quest: .swirl_tonkins_6 }
	]
}

dialogue_root .swirl_tonkins_dialogue:
{
	.swirl_tonkins_greetings: { }
}

entity .swirl_tonkins: !NPC
{
	_string: "Swirl Tonkins"
	_dialogue_root: .swirl_tonkins_dialogue
	_loot_table: .npc
	_faction: the_ember_covenant
	_level: 22
	_creature_type: humanoid
	_not_pushable: true
	_sprite: man_74
	_sprite_dead: man_74_dead
}
	
##########################################################################################
# Quest 1

quest realm_of_fire_swirl_tonkins_1:
{
	string: "Planar Attunement"

	text:
	[
		"Use the portal to return to Thalvaron and find Ghorm in Valoris."
	]
	
	description: 
	[
		"Now that you've entered this realm, your spirit has become attuned. This will make it easier for you to return here later if you wish to. Seek out Ghorm, an old friend of mine, who lives in Valoris. He can"
		"help provide you a talisman that will help you. The portal here will take out you to Thalvaron."
	]
	
	completion:
	[
		"You got attuned to the Realm of Fire? Excellent. This talisman should work for you. If Mr. Tonkins sent you it must be important."
	]

	level: 22
	reward_all_items: [ realm_of_fire_talisman ]
}

##########################################################################################
# Quest 2

objective .swirl_tonkins_2:
{
	string: "Lava Worms Slain"
	
	maps: [ realm_of_fire ]
	
	kill_npc: { entities: [ realm_of_fire_lava_worm ] count: 6 }	
}

quest .swirl_tonkins_2:
{
	string: "First Order of Business"

	text:
	[
		"Venture to the Smoldering Fields and kill lava worms."
	]
	
	description: 
	[
		"Before I'll task you with anything that's actually important, I'd like to see what you're made of. The Smoldering Fields west of here has been overrun with lava worms. They don't have anything"
		"to do with Voraghul, but they're quite annoying. Go and thin out their numbers."
	]
	
	progress:
	[
		"It's getting too hot for you?"
	]
	
	completion:
	[
		"Ah, good job."
	]

	level: 23
	prerequisites: [ thalvaron_ghorm_1 ]
	objectives: [ .swirl_tonkins_2 ]
}

##########################################################################################
# Quest 3

loot_group .swirl_tonkins_3_quest_item: {}

item .swirl_tonkins_3_quest_item:
{
	icon: icon_star_3
	item_level: 23
	loot_groups: [ .swirl_tonkins_3_quest_item ]
	flags: [ unique not_sellable ]
	string: "Glowing Amulet"
	flavor: "Ouch! It's burning hot."
}

objective .swirl_tonkins_3:
{
	string: "Glowing Amulet"
	
	maps: [ realm_of_fire ]
	
	collect_items: { item: .swirl_tonkins_3_quest_item count: 1 }
}

quest .swirl_tonkins_3:
{
	string: "Demonic Sorcery"

	text:
	[
		"Kill demons in the Bastion Courtyard until you find an amulet and return it to Ilhuna."
	]
	
	description: 
	[
		"I arrived here not long ago and haven't spend much time exploring. We need to hunt down the mad wizard and prevent him from tapping the powers of Solkara, but where he is and what he is doing exactly is"
		"a mystery. We know that he has summoned an army of demonic creatures and that these are present in great numbers to the north, around the great fortress of Urt.\n"
		"\n"
		"In the courtyard of the bastion a large number of these demons have been gathering. My scout, Ilhuna, has reported that some of these seem to be carrying weird looking amulets. We'd like to get a closer"
		"look at one of them, so I need you to find one, and return it to her. You'll find her in the north eastern corner of the courtyard."
	]
	
	progress:
	[
		"Do you have something for me?"
	]
	
	completion:
	[
		"Very interesting."
	]

	level: 23
	prerequisites: [ .swirl_tonkins_2 ]
	objectives: [ .swirl_tonkins_3 ]
}

##########################################################################################
# Quest 4

loot_group .swirl_tonkins_4_quest_item: {}

item .swirl_tonkins_4_quest_item:
{
	icon: icon_elemental_stone
	item_level: 25
	loot_groups: [ .swirl_tonkins_4_quest_item ]
	flags: [ not_sellable ]
	string: "Corrupted Elemental Stone"
	stack: 6
}

objective .swirl_tonkins_4:
{
	string: "Corrupted Elemental Stones"
	
	maps: [ realm_of_fire ]
	
	collect_items: { item: .swirl_tonkins_4_quest_item count: 6 }
}

quest .swirl_tonkins_4:
{
	string: "Forging a Weapon"

	text:
	[
		"Venture east to the Desolate Plains, obtain stones from the elementals found there, and return to Swirl Tonkins."
	]
	
	description: 
	[
		"The elemental binding you returned to me has given me an important insight into how Voraghul channels the powers of this realm. I think we me might be able to construct some sort of weapon that can damage him."
		"I'm gonna need you to do the heavy lifting. Travel east to the Desolate Plains where you're find a lot of elementals, no doubt under the influence of Voraghul. Go there, slay some of them and collect their"
		"corrupted stones. Return them to me."
	]
	
	progress:
	[
		"Yes?"
	]
	
	completion:
	[
		"Good, but we're not done yet."
	]

	level: 25
	prerequisites: [ .enslaved_fire_elemental ]
	objectives: [ .swirl_tonkins_4 ]
	next_quest: .swirl_tonkins_5
}

##########################################################################################
# Quest 5

loot_group .swirl_tonkins_5_quest_item: {}

item .swirl_tonkins_5_quest_item:
{
	icon: icon_ring_15
	item_level: 25
	loot_groups: [ .swirl_tonkins_5_quest_item ]
	flags: [ not_sellable ]
	string: "Arcane Binding"
	stack: 6
}

objective .swirl_tonkins_5:
{
	string: "Arcane Bindings"
	
	maps: [ realm_of_fire ]
	
	collect_items: { item: .swirl_tonkins_5_quest_item count: 6 }
}

quest .swirl_tonkins_5:
{
	string: "Gathering Power of the Arcane"

	text:
	[
		"Venture south of the Desolate Plains, obtain bindings from the elementals found there, and return to Swirl Tonkins."
	]
	
	description: 
	[
		"We need a few more materials for our weapon against Voraghul. The elemental binding you returned to me earlier was useful, but we need more. The lava south of the Desolate Plains is full of"
		"fire elementals, corrupted by Voraghul. Return their bindings to me."
	]
	
	progress:
	[
		"Yes?"
	]
	
	completion:
	[
		"Excellent."
	]

	level: 25
	prerequisites: [ .swirl_tonkins_4 ]
	objectives: [ .swirl_tonkins_5 ]
	next_quest: .swirl_tonkins_6
}

##########################################################################################
# Quest 6

entity .swirl_tonkins_6_object:
{
	string: "Shrine of Solkara"
	
	systems: [ openable ]

	components:
	{
		position: { }				
		sprite<static>: 
		{ 
			animations:
			[
				{ 
					states: [ default in_combat spawning ] 
					frames: [ lava_shrine_1 lava_shrine_2 lava_shrine_3 lava_shrine_4 ] 		
					frame_delay: 120 
					random_start_frame: true 
					z_offset: -3
				}				
			]		
		}		
		openable: 
		{ 
			verb: use
			range: 1 
			level: 22
			required_quest: .swirl_tonkins_6
			requirements:
			{			
				requirement self<must_have_item>: .swirl_tonkins_6_uninfused_rod
			}
			trigger_ability: $ability
			{
				flags: [ produce_items_target ]
				states: [ default ]
				consume_items: { .swirl_tonkins_6_uninfused_rod: 1 }
				produce_items: { .swirl_tonkins_6_infused_rod: 1 }
			}
		}		

	}
}

item .swirl_tonkins_6_uninfused_rod:
{
	icon: icon_rod_2
	item_level: 26
	flags: [ not_sellable unique ]
	string: "Uninfused Rod"
}

item .swirl_tonkins_6_infused_rod:
{
	icon: icon_rod_1
	item_level: 26
	flags: [ not_sellable unique ]
	string: "Rod of Solkara"
}

objective .swirl_tonkins_6_a:
{
	string: "Voraghul Slain"
	
	maps: [ realm_of_fire ]
	
	kill_npc: { entities: [ realm_of_fire_wizard ] count: 1 }	
}

objective .swirl_tonkins_6_b:
{
	string: "Rod of Solkara"
	
	maps: [ realm_of_fire ]
	
	collect_items: { item: .swirl_tonkins_6_infused_rod count: 1 }
}

quest .swirl_tonkins_6:
{
	string: "Defeating the Mad Wizard"

	text:
	[
		"Infuse the rod at the shrine of Solkara, seek out Voraghul, defeat him, and return to Swirl Tonkins."
	]
	
	description: 
	[
		"Alright, I'll give you this rod I've enchanted using the materials you've provided. Right now it's, unfortunately, quite useless, so we'll need to do something about that.\n"
		"\n"
		"It needs to be infused by a blessing of Solkara, the divine queen of this realm. Only she can expel the mad wizard. Take the rod to her shrine just south of here and ask for her"
		"help. Then seek out the Voraghul and defeat him. Use the blessed rod to defend yourself from his attacks.\n"
		"I'm not sure where he is. Probably somewhere to the south."
	]
	
	progress:
	[
		"Yes?"
	]
	
	completion:
	[
		"Finally, this place might not be doomed after all."
	]

	level: 26
	quest_items: [ .swirl_tonkins_6_uninfused_rod ]
	prerequisites: [ .swirl_tonkins_5 ]
	objectives: [ .swirl_tonkins_6_a .swirl_tonkins_6_b ]
}
